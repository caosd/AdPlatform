<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.stomato.dao.AdPushDao">

	<resultMap type="com.stomato.domain.AdPush" id="adPush">
        <result property="id" column="id" />
        <result property="adresourceId" column="adresource_id" />
        <result property="pushDate" column="push_date" />
        <result property="firstPush" column="first_push" />
        <result property="maxPush" column="max_push" />
        <result property="realPush" column="real_push" />
        <result property="money" column="money" />
        <result property="status" column="status" />
	</resultMap>
	
	<insert id="add" parameterType="com.stomato.domain.AdPush">
		insert into t_ad_push(adresource_id
			<if test="firstPush != null">
				,first_push
			</if>
			<if test="maxPush != null">
				,max_push
			</if>
			<if test="realPush != null">
				,real_push
			</if>
			<if test="money != null">
				,money
			</if>
			<if test="pushDate != null">
				,push_date
			</if>
			,status
		)
		values(#{adresourceId}
		<if test="firstPush != null">
				,#{firstPush}
			</if>
			<if test="maxPush != null">
				,#{maxPush}
			</if>
			<if test="realPush != null">
				,#{realPush}
			</if>
			<if test="money != null">
				,#{money}
			</if>
			<if test="pushDate != null">
				,#{pushDate}
			</if>
			,1)
	</insert>
	<delete id="delete" parameterType="int">
		delete from t_ad_push where id = #{id}
	</delete>
	<update id ="update" parameterType="com.stomato.domain.AdPush">
	    update t_ad_push
	    <set>
	    	<if test="adresourceId != null">adresource_id=#{adresourceId},</if>
	    	<if test="pushDate != null">push_date=#{pushDate},</if>
	    	<if test="firstPush != null">first_push=#{firstPush},</if>
	    	<if test="maxPush != null">max_push=#{maxPush},</if>
	    	<if test="realPush != null">real_push=#{realPush},</if>
	    	<if test="money != null">money=#{money},</if>
	    	<if test="status != null">status=#{status}</if>
	    </set>
	     where id=#{id}
	</update>
	<select id="get" parameterType="int" resultMap="adPush" >
		select id, adresource_id, first_push, max_push, real_push,money,push_date,status
		from t_ad_push where id=#{id} 
	</select>
	<select id="listTotal" parameterType="com.stomato.form.AdPushFormParam" resultType="int">
		<!-- select count(1) from t_ad_push where 1=1
		<if test="adresourceId != null">
		 	and adresource_id = #{adresourceId}
		</if> -->
		SELECT
			count(1)
		FROM
			t_ad_push push,
			t_ad_resource resource,
			t_ad_channel channel
		WHERE
			push.adresource_id = resource.id and resource.channel_id = channel.id
		<if test="adresourceId != null">
		 	and adresource_id = #{adresourceId}
		</if>
	</select>
	<select id="list" parameterType="com.stomato.form.AdPushFormParam" resultMap="adPush" >
		select  id, adresource_id, first_push, max_push, real_push,money,push_date,status
		from t_ad_push where 1=1 
		<if test="adresourceId != null">
		 	and adresource_id = #{adresourceId}
		</if>
		order by pushDate asc
		<if test="offset != null">limit #{offset},#{pageSize}</if>
	</select>
	<select id="getListMap" parameterType="com.stomato.form.AdPushFormParam" resultType="map" >
		SELECT
			push.id,
		    push.push_date,
		    resource.shelf_date,
		    channel.channel_name,
		    resource.ad_name,
			resource.price,
			push.first_push,
			push.max_push,
			push.real_push,
			push.money,
			push.money/push.real_push as arpu,
			push.status
		FROM
			t_ad_push push,
			t_ad_resource resource,
			t_ad_channel channel
		WHERE
			push.adresource_id = resource.id and resource.channel_id = channel.id
		<if test="adresourceId != null">
		 	and adresource_id = #{adresourceId}
		</if>
		order by push_date asc
		<if test="offset != null">limit #{offset},#{pageSize}</if>
	</select>
</mapper>